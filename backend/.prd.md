PRD.md — Product Requirement Document
# 📌 Project: AI Image Editing Integration via n8n + Backend

---

## 🧩 Purpose

Integrate AI image editing using Kie.ai’s "nano-banana-edit" model through an existing **n8n workflow**, triggered by a **custom backend**.

---

## 🎯 Goals

- Build a custom backend (Node.js) that:
  - Accepts `prompt` and `image_url` via POST
  - Triggers the existing n8n webhook
  - Receives final response via the same webhook
  - Returns it to the client

---

## 🔗 n8n Workflow Summary

- **Webhook URL** (POST):  
  `/c7612ff4-9576-4d1b-a0ae-1b419229d78f`

- **Input expected**:
  ```json
  {
    "body": {
      "prompt": "Make it futuristic",
      "image_url": "https://example.com/image.jpg"
    }
  }


Process:

Maps input (Map Input)

Sends to NanoBanana API

Waits 40 seconds

Gets edited image via recordInfo

Returns result through Respond to Webhook

📡 Backend Endpoint Design

POST /edit-image

Request Body:
{
  "prompt": "Make it futuristic",
  "image_url": "https://example.com/image.jpg"
}

Flow:

Backend sends request to n8n webhook

Waits for the final response (image URL / edited data)

Returns that to the client

Response:
{
  "status": "success",
  "data": {
    "image_url": "https://cdn.kie.ai/output/12345.png"
  }
}

⚙️ Tech Stack

Backend: Node.js, Express

Workflow: n8n (hosted separately)

🧪 Test Cases

✅ Prompt and valid image — gets modified image back

🚫 Invalid prompt/image — error from n8n returned

⏱️ Timeouts — backend should handle if n8n takes too long

🔒 Security

n8n webhook is unprotected (unless added)

Backend should not expose the n8n webhook publicly

📌 Notes

n8n delay is fixed (40s), so backend should wait accordingly

n8n returns result as HTTP response to webhook — perfect for synchronous request


---

# 🧑‍💻 Backend Code (Node.js + Express)

Here’s the **complete backend code** to connect with the n8n webhook and return response:

### ✅ `index.js`

```js
const express = require('express');
const axios = require('axios');
const app = express();
const PORT = 3000;

app.use(express.json());

const N8N_WEBHOOK_URL = 'https://<your-n8n-domain>/webhook/c7612ff4-9576-4d1b-a0ae-1b419229d78f';

app.post('/edit-image', async (req, res) => {
  const { prompt, image_url } = req.body;

  if (!prompt || !image_url) {
    return res.status(400).json({ error: 'prompt and image_url are required' });
  }

  try {
    const response = await axios.post(N8N_WEBHOOK_URL, {
      body: {
        prompt,
        image_url
      }
    }, {
      timeout: 70000 // wait up to 70 seconds for n8n response
    });

    return res.json({
      status: 'success',
      data: response.data
    });

  } catch (err) {
    console.error('Error communicating with n8n webhook:', err.message);
    return res.status(500).json({ error: 'Failed to process image.' });
  }
});

app.listen(PORT, () => {
  console.log(`Server running at http://localhost:${PORT}`);
});

✅ How It Works (Diagram)
[Your Backend]
    |
    |  POST /edit-image
    |    { prompt, image_url }
    ↓
[n8n Webhook Triggered]
    |
    | Map Input
    |  → NanoBanana API
    |  → Wait 40s
    |  → Get Result Image
    ↓
[Webhook Responds with Final Result]
    |
    ↓
[Your Backend Sends Response to User]
